<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Claude Code Usage</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: #e6edf3;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #58a6ff, #a371f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .last-updated {
            color: #8b949e;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: transform 0.2s, border-color 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: rgba(88, 166, 255, 0.3);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 8px;
        }

        .stat-value.cost {
            color: #f0883e;
        }

        .stat-value.streak {
            color: #3fb950;
        }

        .stat-label {
            color: #8b949e;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #e6edf3;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .comparison-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .comparison-title {
            font-size: 1rem;
            color: #8b949e;
        }

        .comparison-change {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .comparison-change.up {
            background: rgba(63, 185, 80, 0.2);
            color: #3fb950;
        }

        .comparison-change.down {
            background: rgba(248, 81, 73, 0.2);
            color: #f85149;
        }

        .comparison-value {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .model-breakdown {
            margin-top: 20px;
        }

        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .model-item:last-child {
            border-bottom: none;
        }

        .model-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .model-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .model-dot.opus { background: #a371f7; }
        .model-dot.sonnet { background: #58a6ff; }
        .model-dot.haiku { background: #3fb950; }

        .model-cost {
            color: #f0883e;
            font-weight: 500;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: #8b949e;
            font-size: 0.85rem;
        }

        footer a {
            color: #58a6ff;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .github-corner {
            position: fixed;
            top: 0;
            right: 0;
            z-index: 100;
        }

        .github-corner svg {
            fill: #58a6ff;
            color: #0d1117;
        }

        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out;
        }

        @keyframes octocat-wave {
            0%, 100% { transform: rotate(0); }
            20%, 60% { transform: rotate(-25deg); }
            40%, 80% { transform: rotate(10deg); }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }

        .fun-stat {
            background: linear-gradient(135deg, rgba(163, 113, 247, 0.1), rgba(88, 166, 255, 0.1));
            border: 1px solid rgba(163, 113, 247, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .fun-stat-value {
            font-size: 1.5rem;
            color: #a371f7;
            margin-bottom: 5px;
        }

        .fun-stat-label {
            color: #8b949e;
            font-size: 0.9rem;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            .stat-value {
                font-size: 1.8rem;
            }

            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <a href="https://github.com/nenohi/aizu-cc-usage-dashboard" class="github-corner" aria-label="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C ## 194.5,69.0 197.7,73.2 200.1,77.6 C ## 213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C ## ## 157.9,116.9 156.7,120.9 152.7,124.9 L ## 141.0,136.5 C139.8,137.7 141.6,141.9 141.8,googly141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
    </a>

    <div class="container">
        <header>
            <h1>My Claude Code Usage</h1>
            <p class="last-updated">Last updated: <span id="lastUpdated">Loading...</span></p>
        </header>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalTokens">-</div>
                <div class="stat-label">Total Tokens (This Month)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value cost" id="totalCost">-</div>
                <div class="stat-label">Total Cost (This Month)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value streak" id="streak">-</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgDaily">-</div>
                <div class="stat-label">Avg Daily Tokens</div>
            </div>
        </div>

        <div class="fun-stat" id="funStat">
            <div class="fun-stat-value" id="funValue">-</div>
            <div class="fun-stat-label" id="funLabel">Loading fun stat...</div>
        </div>

        <div class="chart-section">
            <h2 class="chart-title">Daily Token Usage (Last 14 Days)</h2>
            <div class="chart-container">
                <canvas id="dailyChart"></canvas>
            </div>
        </div>

        <div class="comparison-grid">
            <div class="comparison-card">
                <div class="comparison-header">
                    <span class="comparison-title">This Week vs Last Week</span>
                    <span class="comparison-change" id="weekChange">-</span>
                </div>
                <div class="comparison-value" id="thisWeekTokens">-</div>
                <div class="model-breakdown" id="weeklyBreakdown"></div>
            </div>
            <div class="comparison-card">
                <div class="comparison-header">
                    <span class="comparison-title">Model Cost Breakdown</span>
                </div>
                <div class="chart-container" style="height: 200px;">
                    <canvas id="modelChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-section">
            <h2 class="chart-title">Monthly Trend</h2>
            <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <footer>
            <p>Powered by Claude + <a href="https://github.com/ryoppippi/ccusage">ccusage</a></p>
        </footer>
    </div>

    <script>
        // Chart.js default config for dark theme
        Chart.defaults.color = '#8b949e';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

        // Format numbers
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatCost(cost) {
            return '$' + cost.toFixed(2);
        }

        // Calculate streak
        function calculateStreak(dailyData) {
            if (!dailyData || dailyData.length === 0) return 0;

            const sorted = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
            let streak = 0;
            let expectedDate = new Date();
            expectedDate.setHours(0, 0, 0, 0);

            for (const day of sorted) {
                const dayDate = new Date(day.date);
                dayDate.setHours(0, 0, 0, 0);

                const diffDays = Math.floor((expectedDate - dayDate) / (1000 * 60 * 60 * 24));

                if (diffDays === 0 || diffDays === 1) {
                    streak++;
                    expectedDate = dayDate;
                } else {
                    break;
                }
            }

            return streak;
        }

        // Get week data
        function getWeekData(dailyData, weeksAgo = 0) {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay() - (weeksAgo * 7));
            startOfWeek.setHours(0, 0, 0, 0);

            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 7);

            return dailyData.filter(day => {
                const date = new Date(day.date);
                return date >= startOfWeek && date < endOfWeek;
            });
        }

        // Fun stats
        function generateFunStat(totalTokens, totalCost) {
            const funStats = [
                { value: (totalTokens / 250).toFixed(0), label: 'pages of text generated (at ~250 tokens/page)' },
                { value: (totalCost / 5).toFixed(1), label: 'cups of coffee worth of AI' },
                { value: (totalTokens / 750).toFixed(0), label: 'average emails worth of tokens' },
                { value: formatNumber(totalTokens * 4), label: 'approximate characters processed' },
            ];
            return funStats[Math.floor(Math.random() * funStats.length)];
        }

        // Load and render dashboard
        async function loadDashboard() {
            try {
                const [dailyRes, monthlyRes, sessionsRes] = await Promise.all([
                    fetch('data/daily.json'),
                    fetch('data/monthly.json'),
                    fetch('data/sessions.json')
                ]);

                const dailyData = await dailyRes.json();
                const monthlyData = await monthlyRes.json();
                const sessionsData = await sessionsRes.json();

                const daily = dailyData.daily || [];
                const monthly = monthlyData.monthly || [];
                const totals = monthlyData.totals || {};

                // Update last updated
                if (daily.length > 0) {
                    const latestDate = daily[daily.length - 1].date;
                    document.getElementById('lastUpdated').textContent = new Date(latestDate).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }

                // Stats cards
                document.getElementById('totalTokens').textContent = formatNumber(totals.totalTokens || 0);
                document.getElementById('totalCost').textContent = formatCost(totals.totalCost || 0);
                document.getElementById('streak').textContent = calculateStreak(daily) + ' days';

                const avgDaily = daily.length > 0 ? totals.totalTokens / daily.length : 0;
                document.getElementById('avgDaily').textContent = formatNumber(Math.round(avgDaily));

                // Fun stat
                const funStat = generateFunStat(totals.totalTokens || 0, totals.totalCost || 0);
                document.getElementById('funValue').textContent = funStat.value;
                document.getElementById('funLabel').textContent = funStat.label;

                // Daily chart (last 14 days)
                const last14Days = daily.slice(-14);
                new Chart(document.getElementById('dailyChart'), {
                    type: 'bar',
                    data: {
                        labels: last14Days.map(d => new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
                        datasets: [{
                            label: 'Tokens',
                            data: last14Days.map(d => d.totalTokens),
                            backgroundColor: 'rgba(88, 166, 255, 0.6)',
                            borderColor: '#58a6ff',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => formatNumber(value)
                                }
                            }
                        }
                    }
                });

                // Week comparison
                const thisWeek = getWeekData(daily, 0);
                const lastWeek = getWeekData(daily, 1);
                const thisWeekTokens = thisWeek.reduce((sum, d) => sum + d.totalTokens, 0);
                const lastWeekTokens = lastWeek.reduce((sum, d) => sum + d.totalTokens, 0);

                document.getElementById('thisWeekTokens').textContent = formatNumber(thisWeekTokens) + ' tokens';

                const weekChangeEl = document.getElementById('weekChange');
                if (lastWeekTokens > 0) {
                    const change = ((thisWeekTokens - lastWeekTokens) / lastWeekTokens * 100).toFixed(0);
                    weekChangeEl.textContent = (change >= 0 ? '+' : '') + change + '%';
                    weekChangeEl.className = 'comparison-change ' + (change >= 0 ? 'up' : 'down');
                } else {
                    weekChangeEl.textContent = 'N/A';
                }

                // Model breakdown chart
                const currentMonth = monthly[monthly.length - 1];
                if (currentMonth && currentMonth.modelBreakdowns) {
                    const modelColors = {
                        'claude-opus-4-5-20251101': '#a371f7',
                        'claude-sonnet-4-5-20250929': '#58a6ff',
                        'claude-haiku-4-5-20251001': '#3fb950'
                    };

                    const modelLabels = {
                        'claude-opus-4-5-20251101': 'Opus 4.5',
                        'claude-sonnet-4-5-20250929': 'Sonnet 4.5',
                        'claude-haiku-4-5-20251001': 'Haiku 4.5'
                    };

                    new Chart(document.getElementById('modelChart'), {
                        type: 'doughnut',
                        data: {
                            labels: currentMonth.modelBreakdowns.map(m => modelLabels[m.modelName] || m.modelName),
                            datasets: [{
                                data: currentMonth.modelBreakdowns.map(m => m.cost),
                                backgroundColor: currentMonth.modelBreakdowns.map(m => modelColors[m.modelName] || '#8b949e'),
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { padding: 15 }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: ctx => ctx.label + ': ' + formatCost(ctx.raw)
                                    }
                                }
                            }
                        }
                    });
                }

                // Monthly chart
                if (monthly.length > 0) {
                    new Chart(document.getElementById('monthlyChart'), {
                        type: 'line',
                        data: {
                            labels: monthly.map(m => m.month),
                            datasets: [{
                                label: 'Cost',
                                data: monthly.map(m => m.totalCost),
                                borderColor: '#f0883e',
                                backgroundColor: 'rgba(240, 136, 62, 0.1)',
                                fill: true,
                                tension: 0.3,
                                pointRadius: 6,
                                pointHoverRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: value => formatCost(value)
                                    }
                                }
                            }
                        }
                    });
                }

            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                document.getElementById('statsGrid').innerHTML = '<div class="loading">Failed to load data. Make sure data files exist.</div>';
            }
        }

        // Initialize
        loadDashboard();
    </script>
</body>
</html>
